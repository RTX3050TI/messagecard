<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carta de San Valent√≠n üíñ</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', 'Arial', sans-serif;
    background: linear-gradient(135deg, #ff6b6b 0%, #ff8c8c 25%, #ffc0cb 50%, #ffb3d9 75%, #ff7eb3 100%);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    overflow-x: hidden;
    text-align: center;
    color: #333;
    min-height: 100vh;
    position: relative;
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Capa de fondo con part√≠culas */
.particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    overflow: hidden;
}

.particle {
    position: absolute;
    opacity: 0.7;
}

.heart-particle {
    animation: floatDown 8s linear infinite;
    font-size: 24px;
}

.star-particle {
    animation: twinkle 3s ease-in-out infinite;
    font-size: 20px;
}

@keyframes floatDown {
    from {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
    }
    to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
    }
}

@keyframes twinkle {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
}

@keyframes glow {
    0%, 100% { text-shadow: 0 0 5px rgba(233, 30, 99, 0.5); }
    50% { text-shadow: 0 0 20px rgba(233, 30, 99, 1); }
}

@keyframes confettiDrop {
    from {
        transform: translateY(-10px) rotate(0deg);
        opacity: 1;
    }
    to {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
    }
}

/* Pantalla inicial */
#pantallaInicio {
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10;
    position: relative;
    animation: fadeInScale 0.8s ease;
}

@keyframes fadeInScale {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

#pantallaInicio h2 {
    color: white;
    font-size: 2.2em;
    margin-bottom: 30px;
    text-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    animation: bounce 2s ease infinite;
    letter-spacing: 1px;
}

#pantallaInicio .btn-main {
    padding: 18px 40px;
    font-size: 20px;
    border: none;
    border-radius: 50px;
    background: linear-gradient(90deg, #ff1c73 0%, #ff7eb3 100%);
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px rgba(233, 30, 99, 0.4);
    font-weight: bold;
    letter-spacing: 0.5px;
}

#pantallaInicio .btn-main:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(233, 30, 99, 0.6);
}

#pantallaInicio .btn-main:active {
    transform: translateY(-1px);
}

/* Contenido de la carta */
#contenido {
    display: none;
    padding: 20px;
    animation: fadeInUp 0.8s ease;
    position: relative;
    z-index: 10;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.card {
    background: white;
    padding: 45px 35px;
    border-radius: 30px;
    max-width: 700px;
    width: 95%;
    margin: auto;
    box-shadow: 0 15px 50px rgba(233, 30, 99, 0.25);
    position: relative;
    overflow: hidden;
    animation: cardPopIn 0.7s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent 30%, rgba(255, 107, 107, 0.1) 50%, transparent 70%);
    animation: shine 3s infinite;
}

@keyframes shine {
    0% { transform: translate(-100%, -100%) rotate(45deg); }
    100% { transform: translate(100%, 100%) rotate(45deg); }
}

@keyframes cardPopIn {
    0% {
        opacity: 0;
        transform: scale(0.8) rotateX(-30deg);
    }
    100% {
        opacity: 1;
        transform: scale(1) rotateX(0);
    }
}

.card-content {
    position: relative;
    z-index: 2;
}

h1 {
    color: #e91e63;
    font-size: 2em;
    margin-bottom: 20px;
    animation: glow 2s ease-in-out infinite;
    letter-spacing: 1px;
}

.decorative-line {
    width: 80px;
    height: 3px;
    background: linear-gradient(90deg, transparent, #ff1c73, transparent);
    margin: 15px auto;
    border-radius: 10px;
}

#mensaje {
    font-size: 18px;
    line-height: 1.8;
    color: #555;
    margin: 25px 0;
    text-align: center;
    animation: fadeInUp 1s ease 0.3s both;
}

#mensaje strong {
    color: #e91e63;
}

.heart-decoration {
    display: inline-block;
    animation: pulse 1.5s ease-in-out infinite;
    margin: 0 5px;
}

/* Botones y controles */
.controls {
    margin-top: 30px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    animation: fadeInUp 1s ease 0.5s both;
}

.btn-secondary {
    padding: 12px 24px;
    font-size: 16px;
    border: 2px solid #ff1c73;
    border-radius: 25px;
    background: transparent;
    color: #ff1c73;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: bold;
}

.btn-secondary:hover {
    background: #ff1c73;
    color: white;
    transform: scale(1.05);
}

#musica {
    margin: 10px auto;
    display: none;
    width: 100%;
    max-width: 350px;
    border-radius: 15px;
}

#youtube {
    margin-top: 25px;
}

#youtube iframe {
    border-radius: 20px;
    border: 3px solid #ff1c73;
    box-shadow: 0 8px 20px rgba(233, 30, 99, 0.2);
    max-width: 100%;
    height: auto;
}

/* Efecto luces de ne√≥n */
.neon-text {
    text-shadow: 0 0 10px #ff1c73, 0 0 20px #ff7eb3;
    color: #ff1c73;
}

/* Responsive */
@media (max-width: 600px) {
    .card {
        padding: 25px 20px;
    }
    
    h1 {
        font-size: 1.5em;
    }
    
    #mensaje {
        font-size: 16px;
    }
    
    #pantallaInicio h2 {
        font-size: 1.6em;
    }
}

/* Animaci√≥n especial para el loading */
.loader {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

</style>
</head>

<body>

<!-- Capa de part√≠culas animadas -->
<div class="particles" id="particlesContainer"></div>

<!-- Pantalla inicial -->
<div id="pantallaInicio">
    <h2>üéÅ Tienes algo especial por San Valent√≠n...</h2>
    <button class="btn-main" onclick="abrirCarta()">Abrir Carta üíå</button>
</div>

<!-- Contenido de la carta -->
<div id="contenido">
    <div class="card">
        <div class="card-content">
            <h1 id="titulo">üíñ Para alguien especial üíñ</h1>
            <div class="decorative-line"></div>
            <p id="mensaje"></p>
            <div class="decorative-line"></div>
        </div>
    </div>

    <div class="controls">
        <audio id="musica" controls loop style="display:none;">
            <source src="musica.mp3" type="audio/mpeg">
            Tu navegador no soporta audio.
        </audio>

        <div id="youtube"></div>

        <button class="btn-secondary" onclick="descargarCarta()">üì• Descargar Carta</button>
        <button class="btn-secondary" onclick="compartirCarta()">üì§ Compartir</button>
    </div>
</div>

<script>
// ==================== ANIMACIONES DE PART√çCULAS ====================
function crearParticula() {
    const container = document.getElementById('particlesContainer');
    const particle = document.createElement('div');
    particle.className = 'particle heart-particle';
    
    const emojis = ['üíñ', '‚ù§Ô∏è', 'üíò', 'üíï', 'üíù'];
    particle.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
    
    particle.style.left = Math.random() * 100 + 'vw';
    particle.style.top = -50 + 'px';
    particle.style.fontSize = (15 + Math.random() * 35) + 'px';
    particle.style.animationDuration = (6 + Math.random() * 6) + 's';
    
    container.appendChild(particle);
    
    setTimeout(() => particle.remove(), 12000);
}

// Crear part√≠culas cada 300ms
setInterval(crearParticula, 300);

// ==================== CONFETTI ====================
function lanzarConfetti() {
    const container = document.getElementById('particlesContainer');
    const confettiEmojis = ['üéâ', 'üéä', 'üíï', '‚ú®', 'üåπ', 'üíê'];
    
    for (let i = 0; i < 20; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'particle';
        confetti.innerHTML = confettiEmojis[Math.floor(Math.random() * confettiEmojis.length)];
        
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.top = Math.random() * 30 + 'vh';
        confetti.style.fontSize = (15 + Math.random() * 25) + 'px';
        confetti.style.animation = 'confettiDrop ' + (3 + Math.random() * 3) + 's ease-in forwards';
        confetti.style.opacity = Math.random() * 0.7 + 0.3;
        
        container.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 6000);
    }
}

// ==================== CONTROL DE CARTA ====================
function abrirCarta() {
    document.getElementById('pantallaInicio').style.display = 'none';
    document.getElementById('contenido').style.display = 'flex';
    
    // Lanzar confetti cuando se abre la carta
    lanzarConfetti();
    
    // Reproducir m√∫sica si existe
    const musica = document.getElementById('musica');
    if (musica.querySelector('source').src && musica.querySelector('source').src !== 'musica.mp3') {
        musica.style.display = 'block';
    }
}

// ==================== OBTENER PAR√ÅMETROS ====================
const params = new URLSearchParams(window.location.search);
let para = params.get('para') || 'Mi Amor';
let de = params.get('de') || 'Alguien que te quiere';
let tipo = params.get('tipo') || 'novia';
let fechaExp = params.get('exp');
let yt = params.get('yt');
let genero = params.get('genero') || 'x';

// ==================== VALIDAR EXPIRACI√ìN ====================
if (fechaExp) {
    let limite = new Date(fechaExp);
    if (new Date() > limite) {
        document.body.innerHTML = `
            <div style="
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                font-size: 3em;
                color: white;
                text-shadow: 0 4px 15px rgba(0,0,0,0.3);
                z-index: 100;
                position: relative;
            ">
                ‚è≥ Esta carta ha expirado üíî
            </div>
        `;
        throw new Error('Carta expirada');
    }
}

// ==================== PRONOMBRES Y TEXTOS ====================
const pronombres = {
    f: {
        destin: 'Querida',
        amor: 'amiga',
        novia: 'novia',
        esposa: 'esposa',
        adjetivo: 'hermosa',
        pron: 'ella',
        art: 'la'
    },
    m: {
        destin: 'Querido',
        amor: 'amigo',
        novia: 'novio',
        esposa: 'esposo',
        adjetivo: 'hermoso',
        pron: '√©l',
        art: 'el'
    },
    x: {
        destin: 'Querid@',
        amor: 'amig@',
        novia: 'pareja',
        esposa: 'compa√±er@',
        adjetivo: 'incre√≠ble',
        pron: 'elle',
        art: 'le'
    }
};

const pro = pronombres[genero];

// Diccionario de mensajes
const mensajes = {
    esposa: {
        f: `${pro.destin} esposa ${para},<br><br>
            Hoy, en este d√≠a especial de San Valent√≠n, quiero recordarte lo extraordinaria que eres para m√≠.<br>
            Tu amor ha transformado mi vida en colores brillantes, en sonrisas genuinas y en paz profunda.<br><br>
            Gracias por cada amanecer a tu lado, por tu infinita paciencia, por tus abrazos que me salvan,<br>
            y por ser la br√∫jula que me gu√≠a cuando el camino se oscurece.<br><br>
            Eres mi hogar, mi puerto seguro y mi eternidad. Eres la raz√≥n de mis mejores d√≠as.<br><br>
            Te amo con toda mi alma,<br>
            <strong>Feliz San Valent√≠n, mi amor ‚ù§Ô∏è</strong><br><br>
            Con todo mi coraz√≥n,<br>
            <strong>${de}</strong>`,
        m: `${pro.destin} esposo ${para},<br><br>
            En este San Valent√≠n quiero que sepas cu√°nto significas para m√≠.<br>
            Tu amor ha hecho que mis sue√±os se conviertan en realidad.<br><br>
            Gracias por tu fuerza, tu protecci√≥n, tus palabras de aliento en los momentos dif√≠ciles,<br>
            y por elegirme d√≠a tras d√≠a como tu compa√±era de vida.<br><br>
            Eres mi fortaleza, mi inspiraci√≥n y mi motivo de sonrisa.<br><br>
            Te adoro con toda mi alma,<br>
            <strong>Feliz San Valent√≠n, mi amor ‚ù§Ô∏è</strong><br><br>
            Eternamente tuya,<br>
            <strong>${de}</strong>`,
        x: `${pro.destin} compa√±er@ ${para},<br><br>
            Este San Valent√≠n quiero celebrar lo especial que eres para m√≠.<br>
            Tu presencia llena mis d√≠as de sentido, color y esperanza.<br><br>
            Gracias por ser mi confidente, mi apoyo y mi raz√≥n para sonre√≠r.<br><br>
            Eres incomparable,<br>
            <strong>Feliz San Valent√≠n üíñ</strong><br><br>
            Con infinito cari√±o,<br>
            <strong>${de}</strong>`
    },
    novia: {
        f: `${pro.destin} novia ${para},<br><br>
            No s√© en qu√© momento exacto te convertiste en mi pensamiento favorito,<br>
            pero hoy s√© que cada latido de mi coraz√≥n lleva tu nombre escrito.<br><br>
            Tu sonrisa tiene el poder m√°gico de iluminar mis d√≠as oscuros.<br>
            Tu voz es la melod√≠a que calma mi alma cuando la tormenta llega.<br>
            Tu presencia es como un abrazo eterno que me hace sentir en casa.<br><br>
            Gracias por existir, por compartir tu tiempo conmigo, por tus besos y tus sue√±os.<br>
            Contigo quiero escribir cada cap√≠tulo de mi vida, crear mil recuerdos,<br>
            y hacer promesas que duren para la eternidad.<br><br>
            <strong>Feliz San Valent√≠n, mi coraz√≥n üíï</strong><br><br>
            Siempre tuyo,<br>
            <strong>${de}</strong>`,
        m: `${pro.destin} novio ${para},<br><br>
            Este San Valent√≠n quiero decirte que eres lo mejor que me ha pasado.<br><br>
            Tu sonrisa me hace invencible, tu mirada me disuelve el coraz√≥n,<br>
            y tus brazos son mi lugar favorito del mundo.<br><br>
            Eres mi amo, mi protector y mi sue√±o hecho realidad.<br>
            Contigo quiero construir un imperio de felicidad.<br><br>
            <strong>Feliz San Valent√≠n, amor m√≠o üíï</strong><br><br>
            Por siempre tuya,<br>
            <strong>${de}</strong>`,
        x: `${pro.destin} pareja ${para},<br><br>
            En este San Valent√≠n, te quiero recordar lo especial que eres.<br>
            Eres la raz√≥n de mis mejores sonrisas y mis sue√±os m√°s bonitos.<br><br>
            Contigo, cada d√≠a es una aventura. Contigo, todo vale la pena.<br><br>
            <strong>Feliz San Valent√≠n, mi amor üíï</strong><br><br>
            Con todo mi ser,<br>
            <strong>${de}</strong>`
    },
    amiga: {
        f: `${pro.destin} amiga ${para},<br><br>
            En este d√≠a de amor quiero celebrar el regalo m√°s sincero que tengo: tu amistad.<br><br>
            Tu presencia en mi vida ha sido inspiradora, sanadora y transformadora.<br>
            Gracias por escucharme sin juzgar, por aconsejarme con sabidur√≠a,<br>
            y por estar presente en cada momento, sin pedir nada a cambio.<br><br>
            Las amistades verdaderas son raras como diamantes,<br>
            y t√∫ eres uno de esos tesoros que marca el coraz√≥n para siempre.<br><br>
            <strong>Feliz San Valent√≠n, hermana del alma üå∏</strong><br><br>
            Con profundo cari√±o,<br>
            <strong>${de}</strong>`,
        m: `${pro.destin} amigo ${para},<br><br>
            Este San Valent√≠n quiero que sepas cu√°nto valoras en mi vida.<br><br>
            Tu lealtad, tu risa y tu apoyo incondicional me han sostenido en mis d√≠as m√°s grises.<br>
            Eres m√°s que un amigo, eres mi hermano de coraz√≥n.<br><br>
            Gracias por ser esa persona rara y especial que elige estar,<br>
            sin esperar recompensa, solo porque as√≠ lo sientes.<br><br>
            <strong>Feliz San Valent√≠n, gran amigo ü§ó</strong><br><br>
            Con respeto y admiraci√≥n,<br>
            <strong>${de}</strong>`,
        x: `${pro.destin} amig@ ${para},<br><br>
            En este d√≠a de celebraciones, quiero honrar nuestra amistad.<br><br>
            Eres esa persona que aparece cuando m√°s se necesita.<br>
            Tu risa es contagiosa, tu coraz√≥n es puro, y tu amistad es irremplazable.<br><br>
            <strong>Feliz San Valent√≠n üå∏</strong><br><br>
            Con admiraci√≥n eterna,<br>
            <strong>${de}</strong>`
    },
    otra: {
        f: `${pro.destin} ${para},<br><br>
            No importa el lazo que nos une, s√© que tu lugar en mi vida es especial e irremplazable.<br><br>
            Gracias por ser parte de mi historia, por tus gestos, tu tiempo y tu cari√±o.<br><br>
            <strong>Feliz San Valent√≠n üíñ</strong><br><br>
            Con sincero aprecio,<br>
            <strong>${de}</strong>`,
        m: `${pro.destin} ${para},<br><br>
            Este San Valent√≠n quiero agradecerte por ser parte de mi vida de una manera tan especial.<br><br>
            Eres alguien invaluable, y espero que hoy recuerdes lo importante que eres.<br><br>
            <strong>Feliz San Valent√≠n üíñ</strong><br><br>
            Con sincero cari√±o,<br>
            <strong>${de}</strong>`,
        x: `${pro.destin} ${para},<br><br>
            En este d√≠a especial, quiero celebrar tu presencia en mi vida.<br><br>
            Eres una persona valiosa y mereces toda la felicidad del mundo.<br><br>
            <strong>Feliz San Valent√≠n üíñ</strong><br><br>
            Con profundo respeto,<br>
            <strong>${de}</strong>`
    }
};

// ==================== GENERAR MENSAJE ====================
let textoMensaje = '';

if (mensajes[tipo] && mensajes[tipo][genero]) {
    textoMensaje = mensajes[tipo][genero];
} else if (mensajes[tipo]) {
    // Fallback si el g√©nero no existe
    textoMensaje = Object.values(mensajes[tipo])[0];
} else {
    // Fallback si el tipo no existe
    textoMensaje = mensajes.otra.x;
}

document.getElementById('titulo').innerText = 'üíñ Para ' + para + ' üíñ';
document.getElementById('mensaje').innerHTML = textoMensaje;

// ==================== YOUTUBE ====================
if (yt && /^[a-zA-Z0-9_-]{11}$/.test(yt)) {
    document.getElementById('youtube').innerHTML = `
        <iframe 
            width="100%" 
            style="max-width: 500px; height: 300px; aspect-ratio: 16/9;"
            src="https://www.youtube.com/embed/${yt}?autoplay=1&loop=1&playlist=${yt}" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen>
        </iframe>`;
}

// ==================== DESCARGAR COMO IMAGEN ====================
function descargarCarta() {
    const card = document.querySelector('.card');
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    const rect = card.getBoundingClientRect();
    canvas.width = rect.width;
    canvas.height = rect.height;
    
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = '#e91e63';
    ctx.font = 'bold 32px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('üíñ Para ' + para + ' üíñ', canvas.width / 2, 50);
    
    ctx.fillStyle = '#333';
    ctx.font = '18px Arial';
    ctx.textAlign = 'center';
    const lines = textoMensaje.replace(/<br>/g, '\n').replace(/<[^>]*>/g, '').split('\n');
    let y = 100;
    lines.forEach(line => {
        if (line.trim()) {
            ctx.fillText(line.trim(), canvas.width / 2, y);
            y += 25;
        }
    });
    
    const link = document.createElement('a');
    link.href = canvas.toDataURL('image/png');
    link.download = `Carta-San-Valentin-${para}.png`;
    link.click();
    
    alert('¬°Carta descargada! üíñ');
}

// ==================== COMPARTIR ====================
function compartirCarta() {
    const urlActual = window.location.href;
    
    if (navigator.share) {
        navigator.share({
            title: 'üíñ Carta de San Valent√≠n',
            text: `¬°Abre esta carta especial de ${de} para ti!`,
            url: urlActual
        }).catch(err => console.log('Error al compartir:', err));
    } else {
        // Fallback: copiar URL al portapapeles
        navigator.clipboard.writeText(urlActual).then(() => {
            alert('¬°Enlace copiado al portapapeles! üíñ\nAhora puedes compartirlo con quien desees.');
        });
    }
}

</script>

</body>
</html>
